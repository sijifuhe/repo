# 堡垒机---Jumpserver

## 一、简介

### 1. 什么是 JumpServer

JumpServer 是一款 **开源的堡垒机系统**（Bastion Host），用于统一管理和审计企业内部的服务器、数据库、网络设备等资产的登录和操作。

- 开发语言：Python + Django
- 特点：开源、支持多云、多协议（SSH、RDP 等）、Web 页面操作、支持 SSO（单点登录）。

------

### 2. 为什么用 JumpServer

企业使用 JumpServer 的主要原因是：

1. **安全合规**
   - 统一入口访问，避免直接暴露服务器 IP 和账号。
   - 满足合规要求（如等保、SOX、ISO27001），确保运维可控可追溯。
2. **账号与权限集中管理**
   - 不再把系统账号分散到每台服务器。
   - 支持基于角色、部门分配权限，精细化控制谁能访问哪些资产。
3. **操作审计与追踪**
   - 所有会话都有录像和命令审计。
   - 可以事后回放，快速定位责任。
4. **提升运维效率**
   - Web 页面一键登录，无需记住复杂账号密码。
   - 支持批量命令执行、自动化运维接口。

------

### 3. 用在哪

JumpServer 主要应用在：

- **企业 IT 运维管理**：集中管理 Linux 服务器、Windows 主机、数据库。
- **云平台/混合云环境**：统一入口访问多云主机（如 AWS、阿里云、腾讯云）。
- **金融、政企、互联网公司**：需要严格的安全审计和合规性要求。
- **开发测试环境**：方便管理多台测试服务器，避免账号滥用。

------

总结：
 JumpServer = **企业内部运维安全“总闸门”**，统一管控账号、权限和操作行为，既满足安全审计，又提高运维效率。

## 二、部署

**部署环境**

| 操作系统  | IP地址          | 主机名称       | 所需软件                       |
| --------- | --------------- | -------------- | ------------------------------ |
| Rocky 8.7 | 192.168.100.101 | jmh-Jumpserver | Jumpserver -- Version: v2.28.6 |

**安装依赖**

```bash
[root@localhost ~]#  dnf -y install curl wget vim git tar net-tools lsof unzip
```

**获取jump server安装包**

```bash
[root@localhost ~]# curl -sSL https://github.com/jumpserver/jumpserver/releases/download/v2.28.6/quick_start.sh -o quick_start.sh 
[root@localhost ~]# ls
anaconda-ks.cfg  quick_start.sh  reset.sh
[root@localhost ~]# chmod +x quick_start.sh 
[root@localhost ~]# ./quick_start.sh   #开Tun模式
download install script to /opt/jumpserver-installer-v2.28.6


       ██╗██╗   ██╗███╗   ███╗██████╗ ███████╗███████╗██████╗ ██╗   ██╗███████╗██████╗
       ██║██║   ██║████╗ ████║██╔══██╗██╔════╝██╔════╝██╔══██╗██║   ██║██╔════╝██╔══██╗
       ██║██║   ██║██╔████╔██║██████╔╝███████╗█████╗  ██████╔╝██║   ██║█████╗  ██████╔╝
  ██   ██║██║   ██║██║╚██╔╝██║██╔═══╝ ╚════██║██╔══╝  ██╔══██╗╚██╗ ██╔╝██╔══╝  ██╔══██╗
  ╚█████╔╝╚██████╔╝██║ ╚═╝ ██║██║     ███████║███████╗██║  ██║ ╚████╔╝ ███████╗██║  ██║
   ╚════╝  ╚═════╝ ╚═╝     ╚═╝╚═╝     ╚══════╝╚══════╝╚═╝  ╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝

                                                         Version:  v2.28.6
                                                         
[root@localhost ~]# cd /opt/jumpserver-installer-v2.28.6/ 
[root@localhost jumpserver-installer-v2.28.6]# ls
compose             LICENSE         scripts
config-example.txt  locale          static.env
config_init         quick_start.sh  utils
jmsctl.sh           README.md
[root@localhost jumpserver-installer-v2.28.6]# cp config-example.txt config.txt 
[root@localhost jumpserver-installer-v2.28.6]# vim config.txt  #修改或添加
# Jumpserver 访问的外部地址
SERVER_HOSTNAME=172.16.16.143

# Gunicorn 和 Celery 进程数量（内存不够会卡死，建议先低配）
GUNICORN_WORKERS=2
CELERY_WORKERS=2

# Java 堆内存（默认 256m 即可，小内存机别改大）
JAVA_OPTS=-Xmx256m
```

###### 启动 Jumpserver 

```bash
[root@localhost jumpserver-installer-v2.28.6]# ./jmsctl.sh init
No such command: init
JumpServer 部署管理脚本

Usage: 
  ./jmsctl.sh [COMMAND] [ARGS...]
  ./jmsctl.sh --help

Installation Commands: 
  install           安装 JumpServer
  upgrade [version] 升级 JumpServer
  check_update      检查 JumpServer
  reconfig          重新配置 JumpServer

Management Commands: 
  start             启动 JumpServer
  stop              停止 JumpServer
  close             关闭 JumpServer
  restart           重启 JumpServer
  status            检查 JumpServer
  down              下线 JumpServer
  uninstall         卸载 JumpServer

More Commands: 
  load_image        加载 Docker 镜像
  backup_db         备份数据库
  restore_db [file] 通过数据库备份文件恢复数据
  raw               执行原始 docker-compose 命令
  tail [service]    查看日志

[root@localhost jumpserver-installer-v2.28.6]# ./jmsctl.sh start  # 启动
[+] Running 8/8
 ⠿ Container jms_redis   Healthy                  0.5s
 ⠿ Container jms_mysql   Healthy                  0.5s
 ⠿ Container jms_core    Healthy                  1.0s
 ⠿ Container jms_web     R...                     0.0s
 ⠿ Container jms_celery  Running                  0.0s
 ⠿ Container jms_koko    Running                  0.0s
 ⠿ Container jms_lion    Running                  0.0s
 ⠿ Container jms_magnus  Running                  0.0s
[root@localhost jumpserver-installer-v2.28.6]# ./jmsctl.sh status  # 查看状态
NAME                IMAGE                       COMMAND                  SERVICE             CREATED             STATUS                    PORTS
jms_celery          jumpserver/core:v2.28.6     "./entrypoint.sh sta…"   celery              25 minutes ago      Up 24 minutes (healthy)   8070/tcp, 8080/tcp
jms_core            jumpserver/core:v2.28.6     "./entrypoint.sh sta…"   core                25 minutes ago      Up 24 minutes (healthy)   8070/tcp, 8080/tcp
jms_koko            jumpserver/koko:v2.28.6     "./entrypoint.sh"        koko                25 minutes ago      Up 24 minutes (healthy)   0.0.0.0:2222->2222/tcp, :::2222->2222/tcp, 5000/tcp
jms_lion            jumpserver/lion:v2.28.6     "./entrypoint.sh"        lion                25 minutes ago      Up 24 minutes (healthy)   4822/tcp, 8081/tcp
jms_magnus          jumpserver/magnus:v2.28.6   "./entrypoint.sh"        magnus              25 minutes ago      Up 24 minutes (healthy)   0.0.0.0:30000-30100->30000-30100/tcp, :::30000-30100->30000-30100/tcp
jms_mysql           jumpserver/mariadb:10.6     "docker-entrypoint.s…"   mysql               26 minutes ago      Up 26 minutes (healthy)   3306/tcp
jms_redis           jumpserver/redis:6.2        "docker-entrypoint.s…"   redis               26 minutes ago      Up 26 minutes (healthy)   6379/tcp
jms_web             jumpserver/web:v2.28.6      "/docker-entrypoint.…"   web                 25 minutes ago      Up 24 minutes (healthy)   0.0.0.0:80->80/tcp, :::80->80/tcp

[root@localhost jumpserver-installer-v2.28.6]# ./jmsctl.sh stop  # 停止
```

#### Web 登录 

· 默认管理后台地址：http://192.168.100.101/

· 默认账号密码：

o **用户名**: admin

o **密码**: admin

第一次登录后请立即修改密码。

![image-20250918171057946](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918171057946.png)

![image-20250918171026605](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918171026605.png)

![image-20250918171153657](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918171153657.png)

## 三、 用户管理 / 系统账户 / 特权账户

**用户管理**：添加开发者、运维人员。 

**系统账户**：指资产上的 Linux 用户（如 root、deploy） 

**特权账户**：允许执行敏感命令（比如 root 权限），可和审计策略绑定。

#### 1.创建用户组

![image-20250918171925895](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918171925895.png)

![image-20250918171950943](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918171950943.png)

#### 2.创建用户

![image-20250918172036544](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172036544.png)

![image-20250918172227649](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172227649.png)

#### 3.特权账户 

**系统用户** 是JumpServer 登录资产时使用的账号，如 root `ssh root@host`，而不是使用该用户名登录资产（ssh admin@host)`;特权用户是资产已存在的, 并且拥有 高级权限 的系统用户， JumpServer 使用该用户来 `推送系统用户`、`获取资产硬件信息` 等;**普通用户** 可以在资产上预先存在，也可以由 特权用户 来自动创建。

![image-20250918172341486](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172341486.png)

![image-20250918172419081](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172419081.png)

#### 四、配置资产

![image-20250918172653137](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172653137.png)

![image-20250918172735891](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918172735891.png)

![image-20250918173000863](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173000863.png)

![image-20250918173122152](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173122152.png)

![image-20250918173146903](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173146903.png)

#### 五、资产授权

![image-20250918173250150](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173250150.png)

![image-20250918173406785](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173406785.png)

#### 测试

![image-20250918173630706](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918173630706.png)

![image-20250918174325005](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174325005.png)

![image-20250918174413950](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174413950.png)

![image-20250918174521686](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174521686.png)

####  限制客户指令

![image-20250918174623092](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174623092.png)

![image-20250918174714278](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174714278.png)

![image-20250918174729304](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174729304.png)

![image-20250918174759875](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918174759875.png)

![image-20250918175030370](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918175030370.png)

#### 历史操作审计 

![image-20250918175116582](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918175116582.png)

![image-20250918175149742](C:\Users\18748\AppData\Roaming\Typora\typora-user-images\image-20250918175149742.png)